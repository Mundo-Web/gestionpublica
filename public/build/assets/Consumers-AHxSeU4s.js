var Z=Object.defineProperty;var L=(s,t,o)=>t in s?Z(s,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[t]=o;var B=(s,t,o)=>(L(s,typeof t!="symbol"?t+"":t,o),o);import{r as g,R as e}from"./InitialsImage-TT1qJ6UJ.js";import{c as Q}from"./ReactAppend-a8kO4t2O.js";import"./ProductCard-dOZJj7Ly.js";import{C as ee}from"./CreateReactScript-IbCTOT6z.js";import{B as U}from"./BasicRest-6H19Tby_.js";import{T as N}from"./tippy-react.esm-XNE3m1lc.js";import{R as F}from"./OfferForm-lYy4sNFA.js";import{m as R}from"./main-jzs2GwAM.js";import{a as V}from"./arrayJoin-X0k7NUGR.js";import{S}from"./FormEstudiante-RLgjK21C.js";import"./_commonjsHelpers-4gQjN7DL.js";import"./index-pEm_mg_4.js";import"./CreateReactScript-GhS-uPZF.js";import"./axios-_sX4vCAy.js";const te=({gridRef:s,rest:t,columns:o,toolBar:i,masterDetail:m,filterValue:x,exportable:h,exportableName:v,customizeCell:r=()=>{},selectable:f=!1})=>(g.useEffect(()=>{DevExpress.localization.locale(navigator.language),$(s.current).dxDataGrid({language:"es",dataSource:{load:async u=>await t.paginate({...u,_token:$('[name="csrf_token"]').attr("content")})},onToolbarPreparing:u=>{const{items:b}=u.toolbarOptions;i(b)},remoteOperations:!0,columnResizingMode:"widget",allowColumnResizing:!0,allowColumnReordering:!0,columnAutoWidth:!0,scrollbars:"auto",filterPanel:{visible:!0},searchPanel:{visible:!0},headerFilter:{visible:!0,search:{enabled:!0}},height:"calc(100vh - 185px)",filterValue:x||null,export:{enabled:h},selection:f?{mode:"multiple",selectAllMode:"page"}:null,onExporting:function(u){var b=new ExcelJS.Workbook,c=b.addWorksheet("Main sheet");DevExpress.excelExporter.exportDataGrid({worksheet:c,component:u.component,customizeCell:function(p){r(p),p.excelCell.alignment={horizontal:"left",vertical:"top",...p.excelCell.alignment}}}).then(function(){b.xlsx.writeBuffer().then(function(p){saveAs(new Blob([p],{type:"application/octet-stream"}),`${v}.xlsx`)})})},rowAlternationEnabled:!0,showBorders:!0,filterRow:{visible:!0,applyFilter:"auto"},filterBuilderPopup:{visible:!1,position:{of:window,at:"top",my:"top",offset:{y:10}}},paging:{pageSize:10},pager:{visible:!0,allowedPageSizes:[5,10,25,50,100],showPageSizeSelector:!0,showInfo:!0,showNavigationButtons:!0},allowFiltering:!0,scrolling:{mode:"standard",useNative:!0,preloadEnabled:!0,rowRenderingMode:"standard"},columnChooser:{title:"Mostrar/Ocultar columnas",enabled:!0,mode:"select",search:{enabled:!0}},columns:o,masterDetail:m,onContentReady:(...u)=>{tippy(".tippy-here",{arrow:!0,animation:"scale"})}}).dxDataGrid("instance"),tippy(".dx-button",{arrow:!0})},[null]),e.createElement("div",{id:"grid-container",ref:s})),ae=({title:s,gridRef:t,rest:o,columns:i,toolBar:m,masterDetail:x,filterValue:h,exportable:v=!1,customizeCell:r,selectable:f=!1})=>e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"w-full px-4 sm:px-6 lg:px-8 py-8 max-w-9xl mx-auto"},e.createElement("div",{className:"bg-white rounded-lg shadow-md"},e.createElement("div",{className:"p-4"},e.createElement("h4",{className:"text-lg font-semibold mb-4"},e.createElement("div",{id:"header-title-options",className:"float-right"}),e.createElement("span",{id:"header-title-prefix"})," Lista de ",s," ",e.createElement("span",{id:"header-title-suffix"})),e.createElement(te,{exportableName:s,gridRef:t,rest:o,columns:i.filter(Boolean),toolBar:m,masterDetail:x,filterValue:h,exportable:v,customizeCell:r,selectable:f})))));class ne extends U{constructor(){super(...arguments);B(this,"path","admin/consumers")}}const W=({className:s,title:t,icon:o,onClick:i,...m})=>$("<div>").dxButton({hint:t,template:(x,h)=>{h.addClass(`${o} d-block`)},elementAttr:{class:`${s} position-relative me-1 px-1 py-0 tippy-here`,...m},onClick:i}),H=(s,t)=>{const o=document.createElement("div");s.append(o),Q(o).render(t)};class re extends U{constructor(){super(...arguments);B(this,"path","admin/courses");B(this,"assign",async o=>{try{const{status:i,result:m}=await R.Fetch(`/api/${this.path}/assign`,{method:"POST",body:R.JSON.stringify(o)});if(!i)throw new Error((m==null?void 0:m.message)||"Ocurrio un error inesperado");return R.Notify.add({icon:"/images/icon.svg",title:"Correcto",body:m.message,type:"success"}),m.data}catch(i){return R.Notify.add({icon:"/images/icon.svg",title:"Error",body:i.message,type:"danger"}),null}})}}const J=({className:s,...t})=>e.createElement(e.Fragment,null,e.createElement("div",{className:`px-4 flex items-center gap-2 py-3 text-sm text-gray-900 rounded border shadow ${s}`},e.createElement("img",{className:"h-10 w-10 flex-shrink-0 object-cover object-center rounded-full",src:`/storage/${t==null?void 0:t.profile_photo_path}`,alt:`Perfil de ${t==null?void 0:t.name} ${(t==null?void 0:t.lastname)||""}`,onError:o=>o.target.src=`https://ui-avatars.com/api/?name=${t==null?void 0:t.name}+${(t==null?void 0:t.lastname)||""}&color=7F9CF5&background=EBF4FF`}),e.createElement("div",{className:"min-w-0 flex-1"},e.createElement("div",{className:"font-medium truncate"},t==null?void 0:t.name," ",(t==null?void 0:t.lastname)||""),e.createElement("div",{className:"truncate text-gray-500"},t==null?void 0:t.email)))),se=(s=[],t=(o,i)=>o==i)=>s[0].filter(o=>s.every(i=>i.some(m=>t(m,o)))),oe=new ne,M=new re;F.setAppElement("#app");const K={content:{width:"95%",maxWidth:"420px",height:"max-content",maxHeight:"95vh",overflowY:"auto",zIndex:"40",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}},le={content:{width:"95%",maxWidth:"660px",height:"max-content",maxHeight:"95vh",overflowY:"auto",zIndex:"40",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}},ce=()=>{var P,I,G,_,j,q;const s=g.useRef(),t=g.useRef(),[o,i]=g.useState(!1),[m,x]=g.useState(!1),[h,v]=g.useState(!1),[r,f]=g.useState(null),[u,b]=g.useState(null),[c,p]=g.useState([]),[E,A]=g.useState([]),O=a=>{i(!0),p([]),f(a)},T=a=>{x(!0),f(a)},z=async a=>{const n=a.target.value.trim();if(!n){A([]);return}const l=[["producto","contains",n]];let d=[];h?d=[...se(u.map(w=>w.courses),(w,k)=>w.id==k.id),...c].map(w=>["id","=",w.id]):d=[...r==null?void 0:r.courses,...c].map(C=>["id","=",C.id]),d.length>0&&l.push(["!",V(d,"or")]);const y=await M.paginate({filter:V(l,"and")});A((y==null?void 0:y.data)??[])},D=a=>{p(n=>n.filter(d=>d.id!=a))},Y=async()=>{var d;const{isConfirmed:a}=await S.fire({title:"Asignar cursos",text:`¿Está seguro de asignar ${c.length} ${c.length==1?"curso":"cursos"} a ${(d=r==null?void 0:r.name)==null?void 0:d.split(" ")[0]}?`,icon:"question",showCancelButton:!0,confirmButtonText:"Asignar",cancelButtonText:"Cancelar",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33"});if(!a)return;const n={user_id:r==null?void 0:r.id,courses:c.map(({id:y})=>y)},l=await M.assign(n);l&&(f(l),p([]),$(s.current).dxDataGrid("instance").refresh())},X=async()=>{const{isConfirmed:a}=await S.fire({title:"Asignar cursos",text:`¿Está seguro de asignar ${c.length} ${c.length==1?"curso":"cursos"} a ${u.length} ${u.length==1?"alumno":"alumnos"}?`,icon:"question",showCancelButton:!0,confirmButtonText:"Asignar",cancelButtonText:"Cancelar",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33"});if(!a)return;let n=0;const l=u.length,d=S.mixin({title:"Asignación en curso",allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!1});d.fire({html:`Se han asignado cursos a ${n}/${l} alumnos`});for(const y of u){const C=c.filter(w=>!y.courses.find(k=>w.id===k.id));C.length>0?await M.assign({user_id:y.id,courses:C.map(({id:k})=>k)})&&(n++,d.update({html:`Se han asignado cursos a ${n}/${l} alumnos`})):(n++,d.update({html:`Se han asignado cursos a ${n}/${l} alumnos`}))}d.close(),await S.fire({title:"Asignación completada",text:"Todos los cursos han sido asignados correctamente.",icon:"success",confirmButtonText:"Aceptar"}),$(s.current).dxDataGrid("instance").refresh(),$(s.current).dxDataGrid("instance").deselectAll(),v(!1),p([])};return e.createElement(e.Fragment,null,e.createElement(ae,{gridRef:s,title:"Alumnos",rest:oe,selectable:!0,toolBar:a=>{a.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(s.current).dxDataGrid("instance").refresh()}}),a.unshift({widget:"dxButton",location:"after",options:{icon:"fas fa-book",hint:"Asignar cursos",onClick:()=>{const n=$(s.current).dxDataGrid("instance").getSelectedRowKeys();if(n.length==0)return S.fire({title:"Selecciona un alumno",text:"Selecciona al menos un alumno para asignar cursos",icon:"warning",confirmButtonText:"Ok"});b(n),p([]),v(!0)}}})},columns:[{dataField:"name",caption:"Nombres"},{dataField:"lastname",caption:"Apellidos"},{dataField:"email",caption:"Correo"},{dataField:"courses",caption:"Cursos",cellTemplate:(a,{data:n})=>{H(a,e.createElement(N,{content:"Ver/Asignar cursos"},e.createElement("button",{onClick:()=>O(n)},e.createElement("i",{className:"fa fa-book me-1"}),n.courses.length)))},allowFiltering:!1},{dataField:"certificates_count",caption:"Certificados",cellTemplate:(a,{data:n})=>{var l;H(a,e.createElement(N,{content:"Ver/Asignar certificados"},e.createElement("button",{onClick:()=>T(n)},e.createElement("i",{className:"fa fa-mortar-board me-1"}),((l=n.cetificates)==null?void 0:l.length)||0)))}},{dataField:"created_at",caption:"Fecha creacion",dataType:"datetime",format:"yyyy-MM-dd HH:mm:ss",sortOrder:"desc"},{caption:"Acciones",cellTemplate:(a,{data:n})=>{a.append(W({className:"px-2 py-0 text-xs font-medium text-blue-700 bg-blue-100 rounded hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 ease-in-out border-none text-blue-500",title:"Ver/Asignar cursos",icon:"fa fa-book",onClick:()=>O(n)})),a.append(W({className:"px-2 py-0 text-xs font-medium text-green-500 bg-green-100 rounded hover:bg-green-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition duration-150 ease-in-out border-none text-green-500",title:"Ver/Asignar certificados",icon:"fa fa-mortar-board",onClick:()=>T(n)}))},allowFiltering:!1,allowExporting:!1}]}),e.createElement(F,{isOpen:o,style:K,onRequestClose:()=>{i(!1),f(null)}},e.createElement("h4",{className:"text-lg font-semibold mb-4"},"Ver/Asignar cursos"),e.createElement(J,{...r,className:"mb-4"}),e.createElement("div",{className:"mb-2 flex justify-between text-md text-start text-gray-700 font-semibold"},"Lista de cursos"),e.createElement("div",{className:"relative mb-2"},e.createElement("div",{className:"relative"},e.createElement("div",{className:"absolute inset-y-0 start-0 flex items-center ps-3.5 pointer-events-none"},e.createElement("i",{className:"fa fa-book"})),e.createElement("input",{ref:t,type:"search",className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full ps-10 p-2.5  outline-none",placeholder:"Ingrese el nombre de un curso",onChange:z,autoComplete:"off"})),e.createElement("div",{className:`${E.length>0?"absolute":"hidden"} z-10 bg-white rounded border w-full shadow mt-1`},e.createElement("ul",{className:"max-h-48 py-2 overflow-y-auto text-gray-700 ","aria-labelledby":"dropdownUsersButton"},E==null?void 0:E.map((a,n)=>e.createElement("li",{key:n,className:"w-full"},e.createElement(N,{content:`Clic para agregar ${a.producto}`},e.createElement("button",{className:"flex items-center w-full px-4 py-2 hover:bg-gray-100 text-start",onClick:()=>{p(l=>[...l,a]),A([]),t.current.value=""}},e.createElement("img",{className:"w-6 h-6 me-2 rounded-full",src:`/${a.imagen}`,alt:a.producto,onError:l=>l.target.src="/images/img/noimagen.jpg"}),e.createElement("span",{className:"flex-1 truncate"},a.producto)))))))),e.createElement("div",{className:"relative border shadow rounded mb-4"},e.createElement("table",{className:"w-full text-sm text-left rtl:text-right text-gray-500"},e.createElement("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50"},e.createElement("tr",null,e.createElement("th",{scope:"col",className:"px-6 py-3"},"Curso"),e.createElement("th",{scope:"col",className:"px-6 py-3"},"Estado"))),e.createElement("tbody",null,((P=r==null?void 0:r.courses)==null?void 0:P.length)>0||c.length>0?(I=r==null?void 0:r.courses)==null?void 0:I.map((a,n)=>e.createElement("tr",{key:n,className:"bg-white border-t"},e.createElement("th",{scope:"row",className:"px-6 py-4 font-medium"},e.createElement("div",{className:"line-clamp-1 text-ellipsis w-full"},a.producto)),e.createElement("td",{className:"px-6 py-4 text-blue-500 text-nowrap"},"En curso"))):e.createElement("tr",null,e.createElement("td",{className:"px-6 py-4 text-center text-nowrap",colSpan:2},"- Sin cursos -")),c.map((a,n)=>e.createElement("tr",{key:n,className:"bg-white border-t"},e.createElement("th",{scope:"row",className:"px-6 py-4 font-medium"},e.createElement("div",{className:"line-clamp-1 text-ellipsis w-full"},e.createElement(N,{content:`Quitar ${a.producto}`},e.createElement("i",{className:"fa fa-times text-red-500 font-semibold me-1 cursor-pointer",onClick:()=>D(a.id)})),a.producto)),e.createElement("td",{className:"px-6 py-4 text-gray-500 text-nowrap"},"Por asignar")))))),c.length>0&&e.createElement("div",{className:"text-end"},e.createElement(N,{content:`Asignar ${c.length} ${c.length==1?"curso":"cursos"} a ${(G=r==null?void 0:r.name)==null?void 0:G.split(" ")[0]}`},e.createElement("button",{type:"button",className:"text-gray-900 bg-white border border-gray-300 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-100 font-medium rounded-full text-sm px-5 py-2 me-2 mb-2",onClick:Y},"Asignar")))),e.createElement(F,{isOpen:h,style:le,onRequestClose:()=>{v(!1),b([])}},e.createElement("h4",{className:"text-lg font-semibold mb-4"},"Asignar cursos (Masivo)"),e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4"},e.createElement("div",{className:"col-span-1 md:col-span-2"},e.createElement("div",{className:"mb-2 flex justify-between text-md text-start text-gray-700 font-semibold"},"Lista de Alumnos"),e.createElement("div",{className:"flex flex-col gap-2"},u==null?void 0:u.map((a,n)=>e.createElement(J,{key:n,...a})))),e.createElement("div",{className:"col-span-1 md:col-span-3"},e.createElement("div",{className:"mb-2 flex justify-between text-md text-start text-gray-700 font-semibold"},"Lista de cursos"),e.createElement("div",{className:"relative mb-2"},e.createElement("div",{className:"relative"},e.createElement("div",{className:"absolute inset-y-0 start-0 flex items-center ps-3.5 pointer-events-none"},e.createElement("i",{className:"fa fa-book"})),e.createElement("input",{ref:t,type:"search",className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full ps-10 p-2.5  outline-none",placeholder:"Ingrese el nombre de un curso",onChange:z,autoComplete:"off"})),e.createElement("div",{className:`${E.length>0?"absolute":"hidden"} z-10 bg-white rounded border w-full shadow mt-1`},e.createElement("ul",{className:"max-h-48 py-2 overflow-y-auto text-gray-700 ","aria-labelledby":"dropdownUsersButton"},E==null?void 0:E.map((a,n)=>e.createElement("li",{key:n,className:"w-full"},e.createElement(N,{content:`Clic para agregar ${a.producto}`},e.createElement("button",{className:"flex items-center w-full px-4 py-2 hover:bg-gray-100 text-start",onClick:()=>{p(l=>[...l,a]),A([]),t.current.value=""}},e.createElement("img",{className:"w-6 h-6 me-2 rounded-full",src:`/${a.imagen}`,alt:a.producto,onError:l=>l.target.src="/images/img/noimagen.jpg"}),e.createElement("span",{className:"flex-1 truncate"},a.producto)))))))),e.createElement("div",{className:"relative border shadow rounded mb-4"},e.createElement("table",{className:"w-full text-sm text-left rtl:text-right text-gray-500"},e.createElement("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50"},e.createElement("tr",null,e.createElement("th",{scope:"col",className:"px-6 py-3"},"Curso"),e.createElement("th",{scope:"col",className:"px-6 py-3"},"Estado"))),e.createElement("tbody",null,((_=r==null?void 0:r.courses)==null?void 0:_.length)>0||c.length>0?(j=r==null?void 0:r.courses)==null?void 0:j.map((a,n)=>e.createElement("tr",{key:n,className:"bg-white border-t"},e.createElement("th",{scope:"row",className:"px-6 py-4 font-medium"},e.createElement("div",{className:"line-clamp-1 text-ellipsis w-full"},a.producto)),e.createElement("td",{className:"px-6 py-4 text-blue-500 text-nowrap"},"En curso"))):e.createElement("tr",null,e.createElement("td",{className:"px-6 py-4 text-center text-nowrap",colSpan:2},"- Sin cursos -")),c.map((a,n)=>e.createElement("tr",{key:n,className:"bg-white border-t"},e.createElement("th",{scope:"row",className:"px-6 py-4 font-medium"},e.createElement("div",{className:"line-clamp-1 text-ellipsis w-full"},e.createElement(N,{content:`Quitar ${a.producto}`},e.createElement("i",{className:"fa fa-times text-red-500 font-semibold me-1 cursor-pointer",onClick:()=>D(a.id)})),a.producto)),e.createElement("td",{className:"px-6 py-4 text-gray-500 text-nowrap"},"Por asignar")))))),c.length>0&&e.createElement("div",{className:"text-end"},e.createElement(N,{content:`Asignar ${c.length} ${c.length==1?"curso":"cursos"} a ${(q=r==null?void 0:r.name)==null?void 0:q.split(" ")[0]}`},e.createElement("button",{type:"button",className:"text-gray-900 bg-white border border-gray-300 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-100 font-medium rounded-full text-sm px-5 py-2 me-2 mb-2",onClick:X},"Asignar")))))),e.createElement(F,{isOpen:m,style:K,onRequestClose:()=>{x(!1),f(null)}},e.createElement("h4",{className:"text-lg font-semibold mb-4"},"Ver/Asignar certificados")))};ee((s,t)=>{Q(s).render(e.createElement(ce,{...t}))});
