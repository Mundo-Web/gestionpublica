import{j as e}from"./HtmlContent-MplZTE2r.js";import{r as i}from"./index-TT1qJ6UJ.js";import{c as M}from"./ReactAppend-Y0JQgEOA.js";import{C as L}from"./CreateReactScript-QuaDmwri.js";import{m as h}from"./main-jzs2GwAM.js";import{S as N}from"./OfferCard-mSyxeypM.js";import{T as C}from"./tippy-react.esm-Ethl7wjd.js";import"./ProductCard-q3UQMrn8.js";import{M as S}from"./OfferForm-haHnWwOw.js";import{a as q}from"./arrayJoin-X0k7NUGR.js";import"./_commonjsHelpers-4gQjN7DL.js";import"./index-jtdEOcur.js";import"./CreateReactScript-gj-POL85.js";import"./axios-_sX4vCAy.js";const O=({onClick:r=()=>{},onRemoveClicked:u,radioName:f=null,isParent:m=!1,...l})=>{const d=Number(l.descuento)||0,x=Number(l.precio)||0,g=d>0?d:x;return e.jsxs("a",{href:"#",className:"flex items-center px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 w-full",onClick:t=>r(t,l),children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{className:"rounded-md w-11 h-11",src:`/${l.imagen}`,alt:"Robert image",onError:t=>t.target.src="/images/img/noimagen.jpg"})}),e.jsxs("div",{className:"w-full ps-3",children:[e.jsxs("div",{className:"text-gray-500 text-sm mb-1.5 dark:text-gray-400 overflow-hidden",style:{display:"-webkit-box",WebkitLineClamp:2,textOverflow:"ellipsis",WebkitBoxOrient:"vertical",height:"40px"},children:[f&&e.jsx(C,{content:"Marcar como producto principal",children:e.jsx("input",{className:"mx-1 cursor-pointer",type:"radio",name:f,defaultChecked:m,value:l.id,required:!0})}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:l.producto})," ",l.description||e.jsx("i",{className:"text-gray-400",children:"- Sin Descripcion -"})]}),e.jsxs("div",{className:"text-xs font-semibold text-blue-600 dark:text-blue-500",children:["S/. ",g.toFixed(2)]})]}),u&&e.jsx("div",{className:"flex-shrink-0 ps-3",children:e.jsx("i",{className:"fa fa-trash cursor-pointer",onClick:()=>u(l.id)})})]})},D=({item:r,offers:u,setOffers:f,onOpenModalClicked:m})=>{const l=r.products.sort((t,a)=>{var n,p;return(((n=a==null?void 0:a.pivot)==null?void 0:n.isParent)||0)-(((p=t==null?void 0:t.pivot)==null?void 0:p.isParent)||0)}).slice(0,4).map(t=>t.producto),d=r.products.length,x=async t=>{const{isConfirmed:a}=await N.fire({title:"Eliminar Oferta",text:`¿Estás seguro de que deseas eliminar la oferta "${r.producto}"?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});if(a)try{const{status:n,result:p}=await h.Fetch(`/api/offers/${t}`,{method:"DELETE"});if(!n)throw new Error((p==null?void 0:p.message)??"Ocurrió un error al eliminar la oferta.");N.fire("¡Eliminado!","La oferta ha sido eliminada correctamente.","success");const y=structuredClone(u).filter(k=>k.id!==t);f(y)}catch(n){N.fire("¡Error!",n.message,"error")}},g=async(t,a)=>{$(t.target).parents('[id^="dropdown-menu-"]').addClass("hidden").removeClass("block"),m(a)};return e.jsx("li",{children:e.jsx("div",{className:"inline-flex items-center justify-between w-[300px] p-5 text-gray-500 bg-white border-2 border-gray-200 rounded-lg dark:border-gray-700 peer-checked:border-blue-600  dark:peer-checked:text-gray-300 peer-checked:text-gray-600  dark:text-gray-400 dark:bg-gray-800",children:e.jsxs("div",{className:"block w-full",children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("h4",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-[#006BF6] text-[16.45px] font-bold text-xl",children:["S/. ",r.descuento>0?r.descuento:r.precio]}),r.descuento>0&&e.jsx("span",{className:"text-sm text-[#15294C] opacity-60 line-through",children:r.precio})]}),e.jsxs("div",{children:[e.jsx("button",{id:`dropdown-button-${r.id}`,"data-dropdown-toggle":`dropdown-menu-${r.id}`,className:"inline-flex items-center p-2 text-sm font-medium text-center text-gray-900 bg-white rounded-lg outline-none dark:text-white dark:bg-gray-800",type:"button",children:e.jsx("i",{className:"fas fa-ellipsis-v"})}),e.jsx("div",{id:`dropdown-menu-${r.id}`,className:"z-10 hidden bg-white divide-y divide-gray-100 rounded-lg shadow w-44 dark:bg-gray-700 dark:divide-gray-600",children:e.jsxs("ul",{className:"py-2 text-sm text-gray-700 dark:text-gray-200","aria-labelledby":"dropdownMenuIconButton",children:[e.jsx("li",{children:e.jsx("a",{"data-dropdown-hide":`dropdown-menu-${r.id}`,className:"block cursor-pointer px-4 py-2 hover:bg-gray-600 dark:hover:bg-gray-100",onClick:t=>g(t,r),children:"Ver productos"})}),e.jsx("li",{children:e.jsx("a",{"data-dropdown-hide":`dropdown-menu-${r.id}`,className:"block cursor-pointer px-4 py-2 hover:bg-gray-600 dark:hover:bg-gray-100",onClick:()=>x(r.id),children:"Eliminar"})})]})})]})]}),e.jsx("div",{className:"w-full text-lg font-semibold",children:r.producto}),e.jsx("hr",{className:"my-2"}),e.jsx("div",{className:"w-full text-sm h-20 overflow-hidden",children:d>0?l.map((t,a)=>a>=3&&d>4?e.jsxs("p",{className:"w-full text-nowrap overflow-hidden text-ellipsis",children:[d-3," productos mas"]},`product-${a}`):e.jsx("p",{className:"w-full text-nowrap overflow-hidden text-ellipsis",children:a==0?e.jsx("b",{children:t}):t},`product-${a}`)):e.jsx("i",{className:"text-gray-400",children:"- No hay productos asociados -"})})]})})},`offer-${r.id}`)},J={content:{width:"400px",top:"50%",left:"50%",transform:"translate(-50%, -50%)",height:"calc(100vh - 140px)"}},z=({data:r,setData:u,refreshOffers:f})=>{let m=new AbortController;const l=i.useRef(),d=i.useRef(),x=i.useRef(),g=i.useRef(),t=i.useRef(),a=i.useRef(),[n,p]=i.useState([]),[y,k]=i.useState([]),[E,w]=i.useState(!1),[j,R]=i.useState(!1),v=n.reduce((o,s)=>(Number(s.descuento)||0)>0?o+Number(s.descuento):o+Number(s.precio),0);i.useEffect(()=>{r!=null?w(!0):w(!1),console.log("temrino de cargar")},[r]);const P=async o=>{o.preventDefault();try{const{status:s,result:c}=await h.Fetch("/api/offers",{method:"PATCH",body:h.JSON.stringify({id:l.current.value,producto:d.current.value,precio:v,descuento:g.current.value,parent_id:$('input[name="isParent"]:checked').val()??null,products:structuredClone(n).map(({id:b})=>b)})});if(!s)throw new Error((c==null?void 0:c.message)??"Ocurrio un error al guardar el combo");w(!1),u(null),f()}catch(s){Swal.fire("¡Error!",s.message,"error")}},F=()=>{l.current.value=(r==null?void 0:r.id)??"",d.current.value=(r==null?void 0:r.producto)??"",g.current.value=(r==null?void 0:r.descuento)??0,x.current.value=v??0,p((r==null?void 0:r.products)??[])},T=async()=>{m.abort("Nothing");const o=[["products.producto","contains",a.current.value]];n.length>0&&o.push("and",["!",q(n.map(({id:I})=>["products.id","=",I]))]),m=new AbortController;const s=m.signal,c=await fetch("/api/products/paginate",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-Xsrf-Token":decodeURIComponent(Cookies.get("XSRF-TOKEN"))},body:h.JSON.stringify({filter:o}),signal:s}),b=h.JSON.parseable(await c.text());c.ok?k(b.data):k([])},A=async(o,s)=>{o.preventDefault();const c=structuredClone(n);c.push(s),p(c),a.current.value="",R(!1)},B=async o=>{const s=structuredClone(n).filter(({id:c})=>c!=o);p(s)};return e.jsx(S,{isOpen:E,style:J,onAfterOpen:F,onRequestClose:()=>u(null),children:e.jsxs("form",{onSubmit:P,children:[e.jsx("input",{type:"hidden",name:"id",ref:l,value:r==null?void 0:r.id}),e.jsxs("div",{className:"flex flex-row items-center justify-between gap-2 mb-2",children:[e.jsx("h4",{className:"text-lg font-semibold",children:r!=null&&r.id?"Actualizar combo":"Nuevo combo"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{type:"submit",className:"px-3 py-2 text-xs font-medium text-center text-white bg-blue-700 rounded-lg hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800",children:e.jsx("i",{className:"fa fa-save"})}),e.jsx("button",{type:"button",className:"px-3 py-2 text-xs font-medium text-center text-white bg-red-700 rounded-lg hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-800",onClick:()=>w(!1),children:e.jsx("i",{className:"fa fa-times"})})]})]}),e.jsxs("div",{className:"w-full grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{htmlFor:"offer-name",className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"Nombre del combo"}),e.jsx("input",{ref:d,type:"text",id:"offer-name","aria-describedby":"helper-text-explanation",className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5  dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:"Ej. Combo gamer",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"offer-precio",className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"Precio total"}),e.jsx("input",{ref:x,type:"number",id:"offer-precio","aria-describedby":"helper-text-explanation",className:"bg-gray-100 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 cursor-not-allowed dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-gray-400 dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:"0.00",step:.01,disabled:!0,value:v,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"offer-oferta",className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"Precio del combo"}),e.jsx(C,{content:"Este precio se le cobrara al cliente al llevar el combo",children:e.jsx("input",{ref:g,type:"number",id:"offer-oferta","aria-describedby":"helper-text-explanation",className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5  dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:"0.00",step:.01,required:!0})})]})]}),e.jsx("hr",{className:"my-4"}),e.jsxs("div",{className:"relative flex flex-col items-center justify-between gap-2",children:[e.jsx("h4",{className:"text-lg font-normal",children:"Lista de productos"}),e.jsxs("button",{type:"button","data-dropdown-toggle":"dropdownResults",className:"text-gray-900 bg-white border border-gray-300 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-100 font-medium rounded-full text-sm px-3 py-1 dark:bg-gray-800 dark:text-white dark:border-gray-600 dark:hover:bg-gray-700 dark:hover:border-gray-600 dark:focus:ring-gray-700",onClick:()=>R(!j),children:[j?e.jsx("i",{className:"fa fa-times me-1"}):e.jsx("i",{className:" fa fa-plus me-1"}),j?"Ocultar":"Agregar"]}),e.jsxs("div",{ref:t,id:"dropdownResults",className:`z-20 ${j?"block":"hidden"} absolute top-20 w-full max-w-sm bg-white divide-y divide-gray-100 rounded-lg dark:bg-gray-800 dark:divide-gray-700`,"aria-labelledby":"dropdownResultsButton",style:{boxShadow:"0 0 10px rgba(0, 0, 0, .25)"},children:[e.jsx("div",{className:"block p-2 font-medium text-center text-gray-700 rounded-t-lg bg-gray-50 dark:bg-gray-800 dark:text-white",children:e.jsx("input",{ref:a,type:"text",id:"small-input",className:"block w-full p-2 text-gray-900 border border-gray-300 rounded-lg bg-gray-50 text-xs focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:"Buscar producto",onChange:T})}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:y.length>0?y.map((o,s)=>e.jsx(O,{...o,onClick:A},`result-${s}`)):e.jsx("i",{className:"block text-gray-400 m-2 max-w-max mx-auto",children:"- No hay resultados -"})})]}),e.jsx("div",{children:n.sort((o,s)=>{var c,b;return(((c=s==null?void 0:s.pivot)==null?void 0:c.isParent)||0)-(((b=o==null?void 0:o.pivot)==null?void 0:b.isParent)||0)}).map((o,s)=>e.jsx(O,{...o,radioName:"isParent",isParent:s==0,onRemoveClicked:B},`item-${s}`))})]})]})})};S.setAppElement("body");const X=({offers:r})=>{const u=i.useRef(),[f,m]=i.useState(r),[l,d]=i.useState(null),x=t=>{d(t)},g=async()=>{location.reload()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-8 flex flex-col gap-6 justify-center items-center min-h-[calc(100vh-64px)] bg-gray-100",children:[e.jsx(C,{content:"Agregar combo",children:e.jsx("button",{type:"button",className:"text-blue-700 border border-blue-700 hover:bg-blue-700 hover:text-white focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-full text-sm p-4 text-center inline-flex items-center dark:border-blue-500 dark:text-blue-500 dark:hover:text-white dark:focus:ring-blue-800 dark:hover:bg-blue-500",onClick:x,children:e.jsx("i",{className:"fa fa-plus"})})}),e.jsx("ul",{className:"flex flex-wrap w-full gap-6 items-center justify-center",children:f.length>0&&f.map((t,a)=>e.jsx(D,{item:t,setItem:d,onOpenModalClicked:x,offers:f,setOffers:m},a))})]}),e.jsx(z,{eRef:u,data:l,setData:d,refreshOffers:g})]})};L((r,u)=>{M(r).render(e.jsx(X,{...u}))});
