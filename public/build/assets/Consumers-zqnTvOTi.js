var Z=Object.defineProperty;var L=(r,t,o)=>t in r?Z(r,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[t]=o;var B=(r,t,o)=>(L(r,typeof t!="symbol"?t+"":t,o),o);import{j as e}from"./InitialsImage-MplZTE2r.js";import{r as p}from"./index-TT1qJ6UJ.js";import{c as Q}from"./ReactAppend-Y0JQgEOA.js";import"./ProductCard-Lg-_9NGT.js";import{C as ee}from"./CreateReactScript-QuaDmwri.js";import{B as U}from"./BasicRest-6H19Tby_.js";import{T as N}from"./tippy-react.esm-Ethl7wjd.js";import{R as E}from"./OfferForm-7SPStB9u.js";import{m as R}from"./main-jzs2GwAM.js";import{a as V}from"./arrayJoin-X0k7NUGR.js";import{S as A}from"./FormEstudiante-XPaDyWhL.js";import"./_commonjsHelpers-4gQjN7DL.js";import"./index-jtdEOcur.js";import"./CreateReactScript-gj-POL85.js";import"./axios-_sX4vCAy.js";const te=({gridRef:r,rest:t,columns:o,toolBar:c,masterDetail:d,filterValue:g,exportable:f,exportableName:v,customizeCell:n=()=>{},selectable:h=!1})=>(p.useEffect(()=>{DevExpress.localization.locale(navigator.language),$(r.current).dxDataGrid({language:"es",dataSource:{load:async m=>await t.paginate({...m,_token:$('[name="csrf_token"]').attr("content")})},onToolbarPreparing:m=>{const{items:b}=m.toolbarOptions;c(b)},remoteOperations:!0,columnResizingMode:"widget",allowColumnResizing:!0,allowColumnReordering:!0,columnAutoWidth:!0,scrollbars:"auto",filterPanel:{visible:!0},searchPanel:{visible:!0},headerFilter:{visible:!0,search:{enabled:!0}},height:"calc(100vh - 185px)",filterValue:g||null,export:{enabled:f},selection:h?{mode:"multiple",selectAllMode:"page"}:null,onExporting:function(m){var b=new ExcelJS.Workbook,i=b.addWorksheet("Main sheet");DevExpress.excelExporter.exportDataGrid({worksheet:i,component:m.component,customizeCell:function(u){n(u),u.excelCell.alignment={horizontal:"left",vertical:"top",...u.excelCell.alignment}}}).then(function(){b.xlsx.writeBuffer().then(function(u){saveAs(new Blob([u],{type:"application/octet-stream"}),`${v}.xlsx`)})})},rowAlternationEnabled:!0,showBorders:!0,filterRow:{visible:!0,applyFilter:"auto"},filterBuilderPopup:{visible:!1,position:{of:window,at:"top",my:"top",offset:{y:10}}},paging:{pageSize:10},pager:{visible:!0,allowedPageSizes:[5,10,25,50,100],showPageSizeSelector:!0,showInfo:!0,showNavigationButtons:!0},allowFiltering:!0,scrolling:{mode:"standard",useNative:!0,preloadEnabled:!0,rowRenderingMode:"standard"},columnChooser:{title:"Mostrar/Ocultar columnas",enabled:!0,mode:"select",search:{enabled:!0}},columns:o,masterDetail:d,onContentReady:(...m)=>{tippy(".tippy-here",{arrow:!0,animation:"scale"})}}).dxDataGrid("instance"),tippy(".dx-button",{arrow:!0})},[null]),e.jsx("div",{id:"grid-container",ref:r})),se=({title:r,gridRef:t,rest:o,columns:c,toolBar:d,masterDetail:g,filterValue:f,exportable:v=!1,customizeCell:n,selectable:h=!1})=>e.jsx("div",{className:"flex flex-wrap",children:e.jsx("div",{className:"w-full px-4 sm:px-6 lg:px-8 py-8 max-w-9xl mx-auto",children:e.jsx("div",{className:"bg-white rounded-lg shadow-md",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("h4",{className:"text-lg font-semibold mb-4",children:[e.jsx("div",{id:"header-title-options",className:"float-right"}),e.jsx("span",{id:"header-title-prefix"})," Lista de ",r," ",e.jsx("span",{id:"header-title-suffix"})]}),e.jsx(te,{exportableName:r,gridRef:t,rest:o,columns:c.filter(Boolean),toolBar:d,masterDetail:g,filterValue:f,exportable:v,customizeCell:n,selectable:h})]})})})});class ae extends U{constructor(){super(...arguments);B(this,"path","admin/consumers")}}const W=({className:r,title:t,icon:o,onClick:c,...d})=>$("<div>").dxButton({hint:t,template:(g,f)=>{f.addClass(`${o} d-block`)},elementAttr:{class:`${r} position-relative me-1 px-1 py-0 tippy-here`,...d},onClick:c}),H=(r,t)=>{const o=document.createElement("div");r.append(o),Q(o).render(t)};class ne extends U{constructor(){super(...arguments);B(this,"path","admin/courses");B(this,"assign",async o=>{try{const{status:c,result:d}=await R.Fetch(`/api/${this.path}/assign`,{method:"POST",body:R.JSON.stringify(o)});if(!c)throw new Error((d==null?void 0:d.message)||"Ocurrio un error inesperado");return R.Notify.add({icon:"/images/icon.svg",title:"Correcto",body:d.message,type:"success"}),d.data}catch(c){return R.Notify.add({icon:"/images/icon.svg",title:"Error",body:c.message,type:"danger"}),null}})}}const J=({className:r,...t})=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:`px-4 flex items-center gap-2 py-3 text-sm text-gray-900 rounded border shadow ${r}`,children:[e.jsx("img",{className:"h-10 w-10 flex-shrink-0 object-cover object-center rounded-full",src:`/storage/${t==null?void 0:t.profile_photo_path}`,alt:`Perfil de ${t==null?void 0:t.name} ${(t==null?void 0:t.lastname)||""}`,onError:o=>o.target.src=`https://ui-avatars.com/api/?name=${t==null?void 0:t.name}+${(t==null?void 0:t.lastname)||""}&color=7F9CF5&background=EBF4FF`}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"font-medium truncate",children:[t==null?void 0:t.name," ",(t==null?void 0:t.lastname)||""]}),e.jsx("div",{className:"truncate text-gray-500",children:t==null?void 0:t.email})]})]})}),re=(r=[],t=(o,c)=>o==c)=>r[0].filter(o=>r.every(c=>c.some(d=>t(d,o)))),oe=new ae,F=new ne;E.setAppElement("#app");const K={content:{width:"95%",maxWidth:"420px",height:"max-content",maxHeight:"95vh",overflowY:"auto",zIndex:"40",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}},le={content:{width:"95%",maxWidth:"660px",height:"max-content",maxHeight:"95vh",overflowY:"auto",zIndex:"40",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}},ie=()=>{var D,P,I,G,_,q;const r=p.useRef(),t=p.useRef(),[o,c]=p.useState(!1),[d,g]=p.useState(!1),[f,v]=p.useState(!1),[n,h]=p.useState(null),[m,b]=p.useState(null),[i,u]=p.useState([]),[j,k]=p.useState([]),M=s=>{c(!0),u([]),h(s)},O=s=>{g(!0),h(s)},T=async s=>{const a=s.target.value.trim();if(!a){k([]);return}const l=[["producto","contains",a]];let x=[];f?x=[...re(m.map(w=>w.courses),(w,S)=>w.id==S.id),...i].map(w=>["id","=",w.id]):x=[...n==null?void 0:n.courses,...i].map(C=>["id","=",C.id]),x.length>0&&l.push(["!",V(x,"or")]);const y=await F.paginate({filter:V(l,"and")});k((y==null?void 0:y.data)??[])},z=s=>{u(a=>a.filter(x=>x.id!=s))},Y=async()=>{var x;const{isConfirmed:s}=await A.fire({title:"Asignar cursos",text:`¿Está seguro de asignar ${i.length} ${i.length==1?"curso":"cursos"} a ${(x=n==null?void 0:n.name)==null?void 0:x.split(" ")[0]}?`,icon:"question",showCancelButton:!0,confirmButtonText:"Asignar",cancelButtonText:"Cancelar",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33"});if(!s)return;const a={user_id:n==null?void 0:n.id,courses:i.map(({id:y})=>y)},l=await F.assign(a);l&&(h(l),u([]),$(r.current).dxDataGrid("instance").refresh())},X=async()=>{const{isConfirmed:s}=await A.fire({title:"Asignar cursos",text:`¿Está seguro de asignar ${i.length} ${i.length==1?"curso":"cursos"} a ${m.length} ${m.length==1?"alumno":"alumnos"}?`,icon:"question",showCancelButton:!0,confirmButtonText:"Asignar",cancelButtonText:"Cancelar",confirmButtonColor:"#3085d6",cancelButtonColor:"#d33"});if(!s)return;let a=0;const l=m.length,x=A.mixin({title:"Asignación en curso",allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!1});x.fire({html:`Se han asignado cursos a ${a}/${l} alumnos`});for(const y of m){const C=i.filter(w=>!y.courses.find(S=>w.id===S.id));C.length>0?await F.assign({user_id:y.id,courses:C.map(({id:S})=>S)})&&(a++,x.update({html:`Se han asignado cursos a ${a}/${l} alumnos`})):(a++,x.update({html:`Se han asignado cursos a ${a}/${l} alumnos`}))}x.close(),await A.fire({title:"Asignación completada",text:"Todos los cursos han sido asignados correctamente.",icon:"success",confirmButtonText:"Aceptar"}),$(r.current).dxDataGrid("instance").refresh(),$(r.current).dxDataGrid("instance").deselectAll(),v(!1),u([])};return e.jsxs(e.Fragment,{children:[e.jsx(se,{gridRef:r,title:"Alumnos",rest:oe,selectable:!0,toolBar:s=>{s.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(r.current).dxDataGrid("instance").refresh()}}),s.unshift({widget:"dxButton",location:"after",options:{icon:"fas fa-book",hint:"Asignar cursos",onClick:()=>{const a=$(r.current).dxDataGrid("instance").getSelectedRowKeys();if(a.length==0)return A.fire({title:"Selecciona un alumno",text:"Selecciona al menos un alumno para asignar cursos",icon:"warning",confirmButtonText:"Ok"});b(a),u([]),v(!0)}}})},columns:[{dataField:"name",caption:"Nombres"},{dataField:"lastname",caption:"Apellidos"},{dataField:"email",caption:"Correo"},{dataField:"courses",caption:"Cursos",cellTemplate:(s,{data:a})=>{H(s,e.jsx(N,{content:"Ver/Asignar cursos",children:e.jsxs("button",{onClick:()=>M(a),children:[e.jsx("i",{className:"fa fa-book me-1"}),a.courses.length]})}))},allowFiltering:!1},{dataField:"certificates_count",caption:"Certificados",cellTemplate:(s,{data:a})=>{var l;H(s,e.jsx(N,{content:"Ver/Asignar certificados",children:e.jsxs("button",{onClick:()=>O(a),children:[e.jsx("i",{className:"fa fa-mortar-board me-1"}),((l=a.cetificates)==null?void 0:l.length)||0]})}))}},{dataField:"created_at",caption:"Fecha creacion",dataType:"datetime",format:"yyyy-MM-dd HH:mm:ss",sortOrder:"desc"},{caption:"Acciones",cellTemplate:(s,{data:a})=>{s.append(W({className:"px-2 py-0 text-xs font-medium text-blue-700 bg-blue-100 rounded hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 ease-in-out border-none text-blue-500",title:"Ver/Asignar cursos",icon:"fa fa-book",onClick:()=>M(a)})),s.append(W({className:"px-2 py-0 text-xs font-medium text-green-500 bg-green-100 rounded hover:bg-green-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition duration-150 ease-in-out border-none text-green-500",title:"Ver/Asignar certificados",icon:"fa fa-mortar-board",onClick:()=>O(a)}))},allowFiltering:!1,allowExporting:!1}]}),e.jsxs(E,{isOpen:o,style:K,onRequestClose:()=>{c(!1),h(null)},children:[e.jsx("h4",{className:"text-lg font-semibold mb-4",children:"Ver/Asignar cursos"}),e.jsx(J,{...n,className:"mb-4"}),e.jsx("div",{className:"mb-2 flex justify-between text-md text-start text-gray-700 font-semibold",children:"Lista de cursos"}),e.jsxs("div",{className:"relative mb-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 start-0 flex items-center ps-3.5 pointer-events-none",children:e.jsx("i",{className:"fa fa-book"})}),e.jsx("input",{ref:t,type:"search",className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full ps-10 p-2.5  outline-none",placeholder:"Ingrese el nombre de un curso",onChange:T,autoComplete:"off"})]}),e.jsx("div",{className:`${j.length>0?"absolute":"hidden"} z-10 bg-white rounded border w-full shadow mt-1`,children:e.jsx("ul",{className:"max-h-48 py-2 overflow-y-auto text-gray-700 ","aria-labelledby":"dropdownUsersButton",children:j==null?void 0:j.map((s,a)=>e.jsx("li",{className:"w-full",children:e.jsx(N,{content:`Clic para agregar ${s.producto}`,children:e.jsxs("button",{className:"flex items-center w-full px-4 py-2 hover:bg-gray-100 text-start",onClick:()=>{u(l=>[...l,s]),k([]),t.current.value=""},children:[e.jsx("img",{className:"w-6 h-6 me-2 rounded-full",src:`/${s.imagen}`,alt:s.producto,onError:l=>l.target.src="/images/img/noimagen.jpg"}),e.jsx("span",{className:"flex-1 line-clamp-2 text-ellipsis text-sm",children:s.producto})]})})},a))})})]}),e.jsx("div",{className:"relative border shadow rounded mb-4",children:e.jsxs("table",{className:"w-full text-sm text-left rtl:text-right text-gray-500",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Curso"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Estado"})]})}),e.jsxs("tbody",{children:[((D=n==null?void 0:n.courses)==null?void 0:D.length)>0||i.length>0?(P=n==null?void 0:n.courses)==null?void 0:P.map((s,a)=>e.jsxs("tr",{className:"bg-white border-t",children:[e.jsx("th",{scope:"row",className:"px-6 py-4 font-medium",children:e.jsx("div",{className:"line-clamp-1 text-ellipsis w-full",children:s.producto})}),e.jsx("td",{className:"px-6 py-4 text-blue-500 text-nowrap",children:"En curso"})]},a)):e.jsx("tr",{children:e.jsx("td",{className:"px-6 py-4 text-center text-nowrap",colSpan:2,children:"- Sin cursos -"})}),i.map((s,a)=>e.jsxs("tr",{className:"bg-white border-t",children:[e.jsx("th",{scope:"row",className:"px-6 py-4 font-medium",children:e.jsxs("div",{className:"line-clamp-1 text-ellipsis w-full",children:[e.jsx(N,{content:`Quitar ${s.producto}`,children:e.jsx("i",{className:"fa fa-times text-red-500 font-semibold me-1 cursor-pointer",onClick:()=>z(s.id)})}),s.producto]})}),e.jsx("td",{className:"px-6 py-4 text-gray-500 text-nowrap",children:"Por asignar"})]},a))]})]})}),i.length>0&&e.jsx("div",{className:"text-end",children:e.jsx(N,{content:`Asignar ${i.length} ${i.length==1?"curso":"cursos"} a ${(I=n==null?void 0:n.name)==null?void 0:I.split(" ")[0]}`,children:e.jsx("button",{type:"button",className:"text-gray-900 bg-white border border-gray-300 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-100 font-medium rounded-full text-sm px-5 py-2 me-2 mb-2",onClick:Y,children:"Asignar"})})})]}),e.jsxs(E,{isOpen:f,style:le,onRequestClose:()=>{v(!1),b([])},children:[e.jsx("h4",{className:"text-lg font-semibold mb-4",children:"Asignar cursos (Masivo)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"col-span-1 md:col-span-2",children:[e.jsx("div",{className:"mb-2 flex justify-between text-md text-start text-gray-700 font-semibold",children:"Lista de Alumnos"}),e.jsx("div",{className:"flex flex-col gap-2",children:m==null?void 0:m.map((s,a)=>e.jsx(J,{...s},a))})]}),e.jsxs("div",{className:"col-span-1 md:col-span-3",children:[e.jsx("div",{className:"mb-2 flex justify-between text-md text-start text-gray-700 font-semibold",children:"Lista de cursos"}),e.jsxs("div",{className:"relative mb-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 start-0 flex items-center ps-3.5 pointer-events-none",children:e.jsx("i",{className:"fa fa-book"})}),e.jsx("input",{ref:t,type:"search",className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg block w-full ps-10 p-2.5  outline-none",placeholder:"Ingrese el nombre de un curso",onChange:T,autoComplete:"off"})]}),e.jsx("div",{className:`${j.length>0?"absolute":"hidden"} z-10 bg-white rounded border w-full shadow mt-1`,children:e.jsx("ul",{className:"max-h-48 py-2 overflow-y-auto text-gray-700 ","aria-labelledby":"dropdownUsersButton",children:j==null?void 0:j.map((s,a)=>e.jsx("li",{className:"w-full",children:e.jsx(N,{content:`Clic para agregar ${s.producto}`,children:e.jsxs("button",{className:"flex items-center w-full px-4 py-2 hover:bg-gray-100 text-start",onClick:()=>{u(l=>[...l,s]),k([]),t.current.value=""},children:[e.jsx("img",{className:"w-6 h-6 me-2 rounded-full",src:`/${s.imagen}`,alt:s.producto,onError:l=>l.target.src="/images/img/noimagen.jpg"}),e.jsx("span",{className:"flex-1 line-clamp-2 text-ellipsis text-sm",children:s.producto})]})})},a))})})]}),e.jsx("div",{className:"relative border shadow rounded mb-4",children:e.jsxs("table",{className:"w-full text-sm text-left rtl:text-right text-gray-500",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Curso"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Estado"})]})}),e.jsxs("tbody",{children:[((G=n==null?void 0:n.courses)==null?void 0:G.length)>0||i.length>0?(_=n==null?void 0:n.courses)==null?void 0:_.map((s,a)=>e.jsxs("tr",{className:"bg-white border-t",children:[e.jsx("th",{scope:"row",className:"px-6 py-4 font-medium",children:e.jsx("div",{className:"line-clamp-1 text-ellipsis w-full",children:s.producto})}),e.jsx("td",{className:"px-6 py-4 text-blue-500 text-nowrap",children:"En curso"})]},a)):e.jsx("tr",{children:e.jsx("td",{className:"px-6 py-4 text-center text-nowrap",colSpan:2,children:"- Sin cursos -"})}),i.map((s,a)=>e.jsxs("tr",{className:"bg-white border-t",children:[e.jsx("th",{scope:"row",className:"px-6 py-4 font-medium",children:e.jsxs("div",{className:"line-clamp-1 text-ellipsis w-full",children:[e.jsx(N,{content:`Quitar ${s.producto}`,children:e.jsx("i",{className:"fa fa-times text-red-500 font-semibold me-1 cursor-pointer",onClick:()=>z(s.id)})}),s.producto]})}),e.jsx("td",{className:"px-6 py-4 text-gray-500 text-nowrap",children:"Por asignar"})]},a))]})]})}),i.length>0&&e.jsx("div",{className:"text-end",children:e.jsx(N,{content:`Asignar ${i.length} ${i.length==1?"curso":"cursos"} a ${(q=n==null?void 0:n.name)==null?void 0:q.split(" ")[0]}`,children:e.jsx("button",{type:"button",className:"text-gray-900 bg-white border border-gray-300 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-100 font-medium rounded-full text-sm px-5 py-2 me-2 mb-2",onClick:X,children:"Asignar"})})})]})]})]}),e.jsx(E,{isOpen:d,style:K,onRequestClose:()=>{g(!1),h(null)},children:e.jsx("h4",{className:"text-lg font-semibold mb-4",children:"Ver/Asignar certificados"})})]})};ee((r,t)=>{Q(r).render(e.jsx(ie,{...t}))});
